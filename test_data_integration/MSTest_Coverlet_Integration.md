## Execution of MSTest in Embold Jenkins plugin
Below is the link to a simple C# repository that contains MSTest cases and can be built using msbuild16 which will be used for reference in the commands used for running MSTest throughout this article (https://github.com/CMARIXTechnolabs/UnitTesting-MSTest-Examples)

Before you begin executing MSTest, make sure Jenkins has to be configured according to the below two stages
###### **Jenkins Configuration**

Steps to configure Jenkins:
1. Click Manage Jenkins and go to Manage Plugins link. More information here: (https://docs.embold.io/installation-and-backup-guide/#configure-plugin-logs)
- **Install MSTest plugin**– This plugin converts MSTest TRX test reports into XML reports used by Embold.
2. Click Manage Jenkins link and go under Global Tool Configuration.
- Install the **MSBuild Plugin** – This plugin helps to build a Visual Studio project (.proj) and solution files (.sln).
- Following two inputs are required here:

  1.```MSBuild.exe```: Name of the MSBuild file should be mentioned.
  2.```C:/ProgramFiles(x86)/MSBuild/14.0/Bin/MSBuild.exe```: Location of the MSBuild on the Jenkins machine should be mentioned.
   
**Note - The MSTest plugin analyzes the Test Execution Report (TRX) generated by MSTest. Hence, the output of MSTest is stored in TRX file.**

###### **Job Configuration**

Steps to configure Jenkins job for MSTest:
1. Build your C# solution. Click Configure link inside the job and add a new Build step for “Build a Visual Studio project or solution using MSBuild”.
- Give the following three inputs for building your solution:
  - Select the executable MSBuild.exe from the dropdown list.
  - Give the solution file with respect to the Jenkins workspace. The format should be: ```{workspace/solution_name}```
    
    E.g: ```%WORKSPACE%\testingMSTestJenkins\UnitTesting-MSTest-Examples.sln```
    where ```testingMSTestJenkins``` is a GitHub project name that is placed incorrectly after the workspace. Avoid making such     mistakes.
  - Command Arguments should be ```Debug``` or ```Release```
    
    E.g: ```/p:Configuration=Release```
2. Add a windows batch command to clear the existing TRX file generated over the workspace.

   ```del %WORKSPACE%/MStestResults.trx```
3. Add a windows batch command to run MSTest over the project.
- First, specify the path in console runner to ```mstest.exe```. You can create an environment variable for the same.
- Second, specify the file path to ```“/resultsfile:”``` where the results are going to be saved.
- Next, paste the path to the DLL in the ```“/testcontainer:”``` where your test executable is located.

  E.g: ```"C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\MSTest.exe" /resultsfile:"%WORKSPACE% \ MStestResults.trx" /testcontainer:"%WORKSPACE%/UnitTesting-MSTest-Examples.Tests/bin/Release/UnitTesting-MSTest-Examples.Tests.dll"  /nologo```
4. To publish MSTest test results in Jenkins, add a new post-build step as “**Publish MSTest test report**“. Specify the path to your **TRX** file (the test results file which you have configured in the above step).

**Note: Skip the ```%WORKSPACE%``` folder path because by default the MSTests Plug-in adds it at the beginning of the path.**

For E.g.: In the above command, the results are stored in “**MStestResults.trx**”.

5. Add and configure Embold Jenkins Plugin. In the **Embold configuration Section**, under **Sybsystems**, select analysis config mode like “**Use Analysis Configuration for Jenkins**”, and ensure that MSTtest module is present in the unit test section and set **reportdir** to ```“%JENKINS_HOME%\\jobs\\%JOB_NAME%\\builds\\%BUILD_NUMBER%\\”```

6. Analyse the code by building the Jenkins Job.

## Integrating Coverlet in Embold Jenkins plugin
Below commands have to be run through command prompt at the location of the CSharp TEST Project inside the solution.
1. Add the Coverlet dependency to the unit test project by installing coverage nuget package:

```>dotnet add package coverlet.msbuild```

See if there are any test cases inside the test project with below command:

```>dotnet test```

**Note:
There should be test DLLs inside the project, ensure that the test project is built successfully. You can do this by simply running the below command**: 

```C:/Users/username/Coverlet/UnitTesting/UnitTesting-MSTest-Examples.Tests>dotnet test```

2. Run coverage tool

```dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura```

If all goes well you can see the **MSTest/Coverlet module** status being set to **DONE** on the console like below:
```console
[EMBOLD] --------------------------------------------------------
[EMBOLD] EMBOLD ANALYSIS SUMMARY                           
[EMBOLD] --------------------------------------------------------
[EMBOLD] INITIALIZING GAMMASCANNER                             [DONE]
[EMBOLD] CHECKING EMBOLD ENVIRONMENT                           [DONE]
[EMBOLD] AUTHENTICATING USER                                   [DONE]
    ...
[EMBOLD] INTEGRATING UNIT TEST RESULTS : MSTEST                [DONE]
[EMBOLD] INTEGRATING CODE COVERAGE RESULTS : COVERLET          [DONE]
[EMBOLD] IDENTIFYING HIGH RISK COMPONENTS                      [DONE]
[EMBOLD] IDENTIFYING ANTI-PATTERNS                             [DONE]
[EMBOLD] CALCULATING RATINGS                                   [DONE]
[EMBOLD] --------------------------------------------------------
[EMBOLD] ANALYSIS SUCCESS                                  
[EMBOLD] --------------------------------------------------------
```
